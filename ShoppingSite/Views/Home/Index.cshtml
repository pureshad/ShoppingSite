@model IEnumerable<ShoppingSite.Models.Entitys.Products>
@using ShoppingSite.Models

@{
    ViewBag.Title = "Home Page";
}


<body class="container">
    <section>
        <div class="home-image">
            <h1>Shopping Site</h1>
            <p class="lead"></p>
            <p><a href="#" class="btn btn-primary btn-lg">About Us! &raquo;</a></p>
            <p><a href="/Home/CreateProduct" class="btn btn-primary btn-sm">Add your product! &raquo;</a></p>


            @*@if (Session["userAdminOnline"] != null && User.Identity.IsAuthenticated)
                {

                }*@

            <a href="/Home/_PartialChat" data-toggle="modal" data-target="#myModal"><strong class="btn btn-success">We Are Online!</strong></a>

        </div>

        <div class="modal container" id="myModal">
            <div id="ChatWindow">
                <div class="modal-dialog">
                    <div class="modal-content">

                    </div>
                </div>
            </div>
        </div>

        <form method="get">
            <div class="container form-border">
                <div class="row">
                    @foreach (var item in Model)
                    {
                        <div class="col-xs-12 col-sm-6 col-md-4">
                            <div>
                                <div>
                                    <div class="frontside">
                                        <div class="card">
                                            <div class="card-body text-center">
                                                <img class="responsive" src="~/Images/@item.Image" alt="image cap">
                                                @if (!item.IsAvailableInStock)
                                                {
                                                    <h4 class="text-danger">Out Of Stock</h4>
                                                }
                                                else
                                                {
                                                    <h4 class="card-title">@item.Name</h4>
                                                }
                                                <p class="card-text">@item.Brand</p>
                                                @Html.ActionLink("View", "Details", "Home", new { id = item.Id }, new { @class = "btn btn-sm btn-primary" })

                                                @if (User.IsInRole(StaticRoles.IsAdmin))
                                                {
                                                    @Html.ActionLink("Edit", "Edit", "Home", new { id = item.Id }, new { @class = "btn btn-sm btn-success" })
                                                }
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div>
                                            <div class="text-center mt-4">
                                                <h4 class="modal-title">@item.CategoryType.Name</h4>
                                                <p class="text-center" id="content">@item.Description</p>
                                                <hr />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    @*@Html.Partial("_UserTrackPartitial");*@
                </div>
            </div>
        </form>
    </section>
</body>

@section scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            $("#ChatWindow").on("click", "a", function () {
                $.ajax({
                    url: '/Home/Chat',
                }).done(function (msg) {
                    $("#showModal").html(msg);
                    $("#myModal").modal();
                })
            });
        });

    </script>

    <script type="text/javascript">
        $('#myModal').load('/Home/_PartialChat');
    </script>

    <script>
        $(document).ready(function () {
    // Reference the auto-generated proxy for the hub.
    var chat = $.connection.chatHub;
    // Create a function that the hub can call back to display messages.
    chat.client.addNewMessageToPage = function (name, message) {
        if (name === "@User.Identity.Name") {
            // Add the message to the page.
            $('#discussion').append('<p type = "text" style = "width:auto; text-align:left;">' + name + ' Says:</p>' + '<p style="color:green; text-align:left;"><strong><img = src="https://www.phplivesupport.com/pics/icons/avatars/public/avatar_7.png" title="' + name + '">'
                + ' </strong> ' + htmlEncode(message) + '</p>');
        }
        else if (name !== "@User.Identity.Name") {
            // Add the message to the page.
            $('#discussion').append('<p type = "text" style = "width:auto; text-align:left;">' + name + ' Says:</p>' + '<p style="color:blue;text-align:right;"><strong><img = src="https://www.phplivesupport.com/pics/icons/avatars/public/avatar_71.png" title="' + name + '">'
                + ' </strong> ' + htmlEncode(message) + '</p>');
        }
    };
    // Get the user name and store it to prepend to messages.
     @*$('#displayname').val(prompt('you name is:', '@User.Identity.Name'));*@

    // Set initial focus to message input box.
    $('#message').focus();
    // Start the connection.
    $.connection.hub.start().done(function () {
        $('#sendmessage').click(function () {
            // Call the Send method on the hub.
            chat.server.send($('#displayname').val(), $('#message').val());
            // Clear text box and reset focus for next comment.
            $('#message').val('').focus();
        });
    });
        });

// This optional function html-encodes messages for display in the page.
function htmlEncode(value) {
    var encodedValue = $('<div />').text(value).html();

    return encodedValue;
}

    </script>

}
